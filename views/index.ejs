<%
  // Helper function to build query string
  function getQueryString(overrides) {
    const params = new URLSearchParams();
    if (req.query.q) params.set('q', req.query.q);
    if (req.query.title_search) params.set('title_search', req.query.title_search);
    if (req.query.member) params.set('member', req.query.member);
    if (req.query.sort) params.set('sort', req.query.sort);
    if (req.query.date_from) params.set('date_from', req.query.date_from);
    if (req.query.date_to) params.set('date_to', req.query.date_to);
    if (req.query.per_page) params.set('per_page', req.query.per_page);
    if (req.query.members) {
      const memberArr = Array.isArray(req.query.members) ? req.query.members : [req.query.members];
      memberArr.forEach(m => params.append('members[]', m));
    }
    // Apply overrides
    if (overrides) {
      Object.keys(overrides).forEach(key => {
        if (overrides[key] !== undefined) {
          params.set(key, overrides[key]);
        }
      });
    }
    return params.toString();
  }
%>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>üå∏ Ê´ªÂùÇ46 „Éñ„É≠„Ç∞„Ç¢„Éº„Ç´„Ç§„Éñ</h1>
      <nav>
        <a href="/">„Éõ„Éº„É†</a>
        <a href="/members">„É°„É≥„Éê„Éº‰∏ÄË¶ß</a>
      </nav>
    </header>

    <main>
      <!-- Ê§úÁ¥¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
      <div class="search-hero">
        <div class="search-header">
          <h2>„Éñ„É≠„Ç∞„ÇíÊ§úÁ¥¢</h2>
          <button onclick="toggleAdvancedSearch()" class="advanced-search-btn" id="advanced-search-btn">‚öôÔ∏è Ë©≥Á¥∞Ê§úÁ¥¢</button>
        </div>

        <form action="/" method="get" class="search-form-main" id="search-form">
          <!-- Âü∫Êú¨Ê§úÁ¥¢ -->
          <div class="basic-search">
            <div class="search-inputs-row">
              <input
                type="text"
                name="q"
                value="<%= keyword %>"
                placeholder="Êú¨ÊñáÂÜÖ„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ..."
                class="search-input-main"
                autofocus
              >
              <input
                type="text"
                name="title_search"
                value="<%= (req.query && req.query.title_search) ? req.query.title_search : '' %>"
                placeholder="„Çø„Ç§„Éà„É´Ê§úÁ¥¢..."
                class="search-input-main"
              >
              <select name="member" class="member-select">
                <option value="">ÂÖ®„É°„É≥„Éê„Éº</option>
                <% members.forEach(member => { %>
                  <option value="<%= member.id %>" <%= (req.query && req.query.member == member.id) ? 'selected' : '' %>><%= member.name %></option>
                <% }) %>
              </select>
              <button type="submit" class="search-button-main">üîç Ê§úÁ¥¢</button>
              <button type="button" onclick="resetSearch()" class="reset-button-main">„É™„Çª„ÉÉ„Éà</button>
            </div>
          </div>

          <!-- Ë©≥Á¥∞Ê§úÁ¥¢ÔºàÂàùÊúüÁä∂ÊÖã„Åß„ÅØÈùûË°®Á§∫Ôºâ -->
          <div class="advanced-search" id="advanced-search" style="display:none;">
            <div class="search-section">
              <h4>Ë°®Á§∫Ë®≠ÂÆö</h4>
              <div class="search-row">
                <label>‰∏¶„Å≥È†Ü:</label>
                <input type="radio" name="sort" value="desc" id="sort-desc" <%= (!req.query || !req.query.sort || req.query.sort === 'desc') ? 'checked' : '' %>>
                <label for="sort-desc">Êñ∞„Åó„ÅÑÈ†Ü</label>
                <input type="radio" name="sort" value="asc" id="sort-asc" <%= (req.query && req.query.sort === 'asc') ? 'checked' : '' %>>
                <label for="sort-asc">Âè§„ÅÑÈ†Ü</label>
              </div>
            </div>

            <div class="search-section">
              <h4>„É°„É≥„Éê„ÉºÈÅ∏ÊäûÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</h4>
              <div class="member-checkboxes-compact">
                <% members.forEach(member => { %>
                  <label class="member-checkbox-item">
                    <input type="checkbox" name="members" value="<%= member.id %>">
                    <span><%= member.name %></span>
                  </label>
                <% }) %>
              </div>
            </div>

            <div class="search-section">
              <h4>ÊäïÁ®øÊúüÈñì</h4>
              <div class="date-range-container">
                <div class="date-input-group">
                  <label>ÈñãÂßãÊó•:</label>
                  <input type="date" name="date_from" class="date-input" value="<%= (req.query && req.query.date_from) ? req.query.date_from : '' %>">
                </div>
                <div class="date-separator">„Äú</div>
                <div class="date-input-group">
                  <label>ÁµÇ‰∫ÜÊó•:</label>
                  <input type="date" name="date_to" class="date-input" value="<%= (req.query && req.query.date_to) ? req.query.date_to : '' %>">
                </div>
              </div>
            </div>

            <div class="search-actions">
              <button type="submit" class="search-button-advanced">üîç Ë©≥Á¥∞Ê§úÁ¥¢ÂÆüË°å</button>
              <button type="button" onclick="resetAdvancedForm()" class="reset-button">„É™„Çª„ÉÉ„Éà</button>
            </div>
          </div>
        </form>
      </div>

      <!-- Áµ±Ë®àÊÉÖÂ†± -->
      <div class="stats-row">
        <% if (typeof isFiltered !== 'undefined' && isFiltered) { %>
          <!-- „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®ÊôÇ„ÅÆÁµ±Ë®à -->
          <div class="stat-card stat-card-highlight" title="„Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®Âæå„ÅÆ„Éñ„É≠„Ç∞ÊäïÁ®øÊï∞">
            <span class="stat-number"><%= filteredStats.totalPosts %></span>
            <span class="stat-label">„Éñ„É≠„Ç∞</span>
          </div>
          <div class="stat-card stat-card-highlight" title="„Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®Âæå„ÅÆÊäïÁ®øËÄÖÊï∞">
            <span class="stat-number"><%= filteredStats.uniqueAuthors %></span>
            <span class="stat-label">ÊäïÁ®øËÄÖ</span>
          </div>
          <div class="stat-card stat-card-highlight" title="„Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®Âæå„ÅÆÁîªÂÉèÊï∞">
            <span class="stat-number"><%= filteredStats.totalImages %></span>
            <span class="stat-label">ÁîªÂÉè</span>
          </div>
          <div class="stat-card stat-card-highlight" title="„Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®Âæå„ÅÆÁîªÂÉè„Çµ„Ç§„Ç∫Ôºà<%= (filteredStats.totalSize / 1024 / 1024).toFixed(2) %> MBÔºâ">
            <span class="stat-number"><%= (filteredStats.totalSize / 1024 / 1024).toFixed(0) %></span>
            <span class="stat-label">MB</span>
          </div>
          <span class="stats-divider">|</span>
        <% } %>
        <!-- ÂÖ®‰Ωì„ÅÆÁµ±Ë®à -->
        <div class="stat-card" title="„Éá„Éº„Çø„Éô„Éº„ÇπÂÖ®‰Ωì„ÅÆ„Éñ„É≠„Ç∞ÊäïÁ®øÊï∞">
          <span class="stat-number"><%= stats.totalPosts || pagination.totalPosts || 0 %></span>
          <span class="stat-label">„Éñ„É≠„Ç∞</span>
        </div>
        <div class="stat-card" title="„Éá„Éº„Çø„Éô„Éº„ÇπÂÖ®‰Ωì„ÅÆÊäïÁ®øËÄÖÊï∞">
          <span class="stat-number"><%= stats.uniqueAuthors || members.length %></span>
          <span class="stat-label">ÊäïÁ®øËÄÖ</span>
        </div>
        <div class="stat-card" title="„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊ∏à„Åø„ÅÆ„Éñ„É≠„Ç∞ÁîªÂÉè„Éï„Ç°„Ç§„É´Êï∞">
          <span class="stat-number"><%= stats.totalFiles %></span>
          <span class="stat-label">ÁîªÂÉè</span>
        </div>
        <div class="stat-card" title="ÁîªÂÉè„ÅÆÁ∑è„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫Ôºà<%= (stats.totalSize / 1024 / 1024).toFixed(2) %> MBÔºâ">
          <span class="stat-number"><%= (stats.totalSize / 1024 / 1024).toFixed(0) %></span>
          <span class="stat-label">MB</span>
        </div>
      </div>

      <!-- Ê§úÁ¥¢ÁµêÊûú„Åæ„Åü„ÅØÊúÄÊñ∞„Éñ„É≠„Ç∞ -->
      <div class="content-section">
        <div class="view-toggle">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <% if (keyword) { %>
                <h3>„Äå<%= keyword %>„Äç„ÅÆÊ§úÁ¥¢ÁµêÊûú: <%= (typeof pagination !== 'undefined' && pagination) ? pagination.totalPosts : posts.length %>‰ª∂</h3>
              <% } else { %>
                <h3>ÊúÄÊñ∞„ÅÆ„Éñ„É≠„Ç∞</h3>
              <% } %>
            </div>
            <div class="per-page-selector">
              <label>Ë°®Á§∫‰ª∂Êï∞:</label>
              <select id="per-page-select" onchange="changePerPage(this.value)">
                <option value="20" <%= (typeof pagination !== 'undefined' && pagination && pagination.perPage == 20) ? 'selected' : '' %>>20‰ª∂</option>
                <option value="50" <%= (typeof pagination !== 'undefined' && pagination && pagination.perPage == 50) ? 'selected' : (!req.query.per_page ? 'selected' : '') %>>50‰ª∂</option>
                <option value="100" <%= (typeof pagination !== 'undefined' && pagination && pagination.perPage == 100) ? 'selected' : '' %>>100‰ª∂</option>
              </select>
            </div>
          </div>
        </div>

        <% if (posts.length === 0) { %>
          <div class="no-results">
            <p>„Éñ„É≠„Ç∞„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</p>
            <% if (keyword) { %>
              <p>Âà•„ÅÆ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÊ§úÁ¥¢„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ</p>
            <% } %>
          </div>
        <% } else { %>
          <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥Ôºà‰∏äÈÉ®Ôºâ -->
          <% if (typeof pagination !== 'undefined' && pagination && pagination.totalPages > 1) { %>
            <div class="pagination-container">
              <div class="pagination">
                <% if (pagination.hasPrev) { %>
                  <a href="?<%= getQueryString({page: pagination.page - 1}) %>" class="page-link">‚Üê Ââç„Å∏</a>
                <% } %>

                <%
                  const maxVisible = 5;
                  let startPage = Math.max(1, pagination.page - Math.floor(maxVisible / 2));
                  let endPage = Math.min(pagination.totalPages, startPage + maxVisible - 1);
                  if (endPage - startPage < maxVisible - 1) {
                    startPage = Math.max(1, endPage - maxVisible + 1);
                  }
                %>

                <% if (startPage > 1) { %>
                  <a href="?<%= getQueryString({page: 1}) %>" class="page-link">1</a>
                  <% if (startPage > 2) { %>
                    <span class="page-dots">...</span>
                  <% } %>
                <% } %>

                <% for (let i = startPage; i <= endPage; i++) { %>
                  <% if (i === pagination.page) { %>
                    <span class="page-current"><%= i %></span>
                  <% } else { %>
                    <a href="?<%= getQueryString({page: i}) %>" class="page-link"><%= i %></a>
                  <% } %>
                <% } %>

                <% if (endPage < pagination.totalPages) { %>
                  <% if (endPage < pagination.totalPages - 1) { %>
                    <span class="page-dots">...</span>
                  <% } %>
                  <a href="?<%= getQueryString({page: pagination.totalPages}) %>" class="page-link"><%= pagination.totalPages %></a>
                <% } %>

                <% if (pagination.hasNext) { %>
                  <a href="?<%= getQueryString({page: pagination.page + 1}) %>" class="page-link">Ê¨°„Å∏ ‚Üí</a>
                <% } %>
              </div>
              <div class="page-info">
                <%= ((pagination.page - 1) * pagination.perPage + 1) %> - <%= Math.min(pagination.page * pagination.perPage, pagination.totalPosts) %> / <%= pagination.totalPosts %>‰ª∂
              </div>
            </div>
          <% } %>

          <!-- „ÉÜ„Éº„Éñ„É´„Éì„É•„Éº -->
          <div id="table-view" class="posts-table">
            <div class="bulk-actions" style="margin-bottom: 15px;">
              <button onclick="selectAll()" class="bulk-btn">ÂÖ®ÈÅ∏Êäû</button>
              <button onclick="deselectAll()" class="bulk-btn">ÂÖ®Ëß£Èô§</button>
              <button onclick="bulkDelete()" class="bulk-delete-btn">ÈÅ∏Êäû„Åó„ÅüÊäïÁ®ø„ÇíÂâäÈô§</button>
              <span id="selected-count" class="selected-info">0‰ª∂ÈÅ∏Êäû‰∏≠</span>
            </div>
            <table>
              <thead>
                <tr>
                  <th width="40px">ÈÅ∏Êäû</th>
                  <th>ÊäïÁ®øÊó•</th>
                  <th>ÊäïÁ®øËÄÖ</th>
                  <th>„Çø„Ç§„Éà„É´</th>
                  <th>ÁîªÂÉè</th>
                  <th>ÂÖ¨Âºè„Çµ„Ç§„Éà</th>
                </tr>
              </thead>
              <tbody>
                <% posts.forEach(post => { %>
                  <tr>
                    <td>
                      <input type="checkbox" class="post-checkbox" value="<%= post.id %>" onchange="updateSelectedCount()">
                    </td>
                    <td><%= post.date %></td>
                    <td>
                      <%= post.member_name %>
                      <% if (post.site === 'keyakizaka46') { %>
                        <span style="color: #2e7d32; font-size: 0.8em;">[Ê¨ÖÂùÇ46]</span>
                      <% } %>
                    </td>
                    <td>
                      <a href="/post/<%= post.id %>" class="title-link">
                        <%= post.title || '„Çø„Ç§„Éà„É´„Å™„Åó' %>
                      </a>
                    </td>
                    <td>
                      <% if (post.images && post.images.length > 0) { %>
                        üì∑ <%= post.images.length %>
                      <% } else { %>
                        -
                      <% } %>
                    </td>
                    <td>
                      <a href="<%= post.url %>" target="_blank">üîó</a>
                    </td>
                  </tr>
                  <tr id="content-<%= post.id %>" class="post-content-row" style="display:none;">
                    <td colspan="6">
                      <div class="post-full-content">
                        <p><%= post.content %></p>
                        <% if (post.local_images && post.local_images.length > 0) { %>
                          <div class="post-images-preview">
                            <% post.local_images.slice(0, 3).forEach(localImg => { %>
                              <img src="<%= toImageUrl(localImg) %>" alt="„Éñ„É≠„Ç∞ÁîªÂÉè" style="max-width:200px; margin:5px;" onerror="this.style.display='none'">
                            <% }) %>
                          </div>
                        <% } else if (post.images && post.images.length > 0) { %>
                          <div class="post-images-preview">
                            <% post.images.slice(0, 3).forEach(img => { %>
                              <img src="<%= img %>" alt="„Éñ„É≠„Ç∞ÁîªÂÉè" style="max-width:200px; margin:5px;">
                            <% }) %>
                          </div>
                        <% } %>
                        <a href="/post/<%= post.id %>" class="detail-link">Ë©≥Á¥∞„ÇíË¶ã„Çã ‚Üí</a>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>

          <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥Ôºà‰∏ãÈÉ®Ôºâ -->
          <% if (typeof pagination !== 'undefined' && pagination && pagination.totalPages > 1) { %>
            <div class="pagination-container" style="margin-top: 20px;">
              <div class="pagination">
                <% if (pagination.hasPrev) { %>
                  <a href="?<%= getQueryString({page: pagination.page - 1}) %>" class="page-link">‚Üê Ââç„Å∏</a>
                <% } %>

                <%
                  const maxVisible2 = 5;
                  let startPage2 = Math.max(1, pagination.page - Math.floor(maxVisible2 / 2));
                  let endPage2 = Math.min(pagination.totalPages, startPage2 + maxVisible2 - 1);
                  if (endPage2 - startPage2 < maxVisible2 - 1) {
                    startPage2 = Math.max(1, endPage2 - maxVisible2 + 1);
                  }
                %>

                <% if (startPage2 > 1) { %>
                  <a href="?<%= getQueryString({page: 1}) %>" class="page-link">1</a>
                  <% if (startPage2 > 2) { %>
                    <span class="page-dots">...</span>
                  <% } %>
                <% } %>

                <% for (let i = startPage2; i <= endPage2; i++) { %>
                  <% if (i === pagination.page) { %>
                    <span class="page-current"><%= i %></span>
                  <% } else { %>
                    <a href="?<%= getQueryString({page: i}) %>" class="page-link"><%= i %></a>
                  <% } %>
                <% } %>

                <% if (endPage2 < pagination.totalPages) { %>
                  <% if (endPage2 < pagination.totalPages - 1) { %>
                    <span class="page-dots">...</span>
                  <% } %>
                  <a href="?<%= getQueryString({page: pagination.totalPages}) %>" class="page-link"><%= pagination.totalPages %></a>
                <% } %>

                <% if (pagination.hasNext) { %>
                  <a href="?<%= getQueryString({page: pagination.page + 1}) %>" class="page-link">Ê¨°„Å∏ ‚Üí</a>
                <% } %>
              </div>
            </div>
          <% } %>
        </div>

          <!-- „Ç´„Éº„Éâ„Éì„É•„Éº -->
          <div id="card-view" class="posts-grid" style="display:none;">
            <% posts.forEach(post => { %>
              <article class="post-card">
                <a href="/post/<%= post.id %>">
                  <div class="post-card-header">
                    <span class="post-author"><%= post.member_name %></span>
                    <span class="post-date"><%= post.date %></span>
                  </div>
                  <h4 class="post-title"><%= post.title || '„Çø„Ç§„Éà„É´„Å™„Åó' %></h4>
                  <p class="post-excerpt">
                    <%= cleanTextPreview(post.content, 100) %>
                  </p>
                  <div class="post-card-footer">
                    <% if (post.images && post.images.length > 0) { %>
                      <span class="image-badge">üì∑ <%= post.images.length %></span>
                    <% } %>
                    <span class="read-more">Á∂ö„Åç„ÇíË™≠„ÇÄ ‚Üí</span>
                  </div>
                </a>
              </article>
            <% }) %>
          </div>
        <% } %>
      </div>

      <!-- „ÇØ„Ç§„ÉÉ„ÇØ„É™„É≥„ÇØ -->
      <div class="quick-links">
        <h3>„É°„É≥„Éê„Éº„Åã„ÇâÊé¢„Åô</h3>
        <div class="member-tags">
          <% members.slice(0, 10).forEach(member => { %>
            <a href="/member/<%= member.id %>" class="member-tag">
              <%= member.name %>
            </a>
          <% }) %>
          <a href="/members" class="member-tag more">
            „Åô„Åπ„Å¶Ë¶ã„Çã ‚Üí
          </a>
        </div>
      </div>
    </main>

    <footer>
      <p>&copy; 2025 Ê´ªÂùÇ46 „Éñ„É≠„Ç∞„Ç¢„Éº„Ç´„Ç§„Éñ</p>
    </footer>
  </div>

  <!-- „Éö„Éº„Ç∏„Éà„ÉÉ„Éó„Å∏Êàª„Çã„Éú„Çø„É≥ -->
  <button id="scroll-to-top" onclick="scrollToTop()" title="„Éö„Éº„Ç∏„Éà„ÉÉ„Éó„Å∏Êàª„Çã">
    ‚Üë
  </button>

  <script>
    // Ë°®Á§∫‰ª∂Êï∞Â§âÊõ¥
    function changePerPage(value) {
      const params = new URLSearchParams(window.location.search);
      params.set('per_page', value);
      params.delete('page'); // „Éö„Éº„Ç∏Áï™Âè∑„Çí„É™„Çª„ÉÉ„Éà
      window.location.href = '?' + params.toString();
    }

    // „Éì„É•„ÉºÂàá„ÇäÊõø„Åà
    function switchView(view) {
      const tableView = document.getElementById('table-view');
      const cardView = document.getElementById('card-view');
      const tableBtn = document.getElementById('table-view-btn');
      const cardBtn = document.getElementById('card-view-btn');

      if (view === 'table') {
        tableView.style.display = 'block';
        cardView.style.display = 'none';
        tableBtn.classList.add('active');
        cardBtn.classList.remove('active');
      } else {
        tableView.style.display = 'none';
        cardView.style.display = 'grid';
        tableBtn.classList.remove('active');
        cardBtn.classList.add('active');
      }
    }

    // „Çø„Ç§„Éà„É´„ÇØ„É™„ÉÉ„ÇØ„ÅßÊú¨ÊñáË°®Á§∫
    function showPostContent(postId) {
      const contentRow = document.getElementById('content-' + postId);
      if (contentRow.style.display === 'none') {
        // ‰ªñ„ÅÆÈñã„ÅÑ„Å¶„ÅÑ„Çã„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈñâ„Åò„Çã
        document.querySelectorAll('.post-content-row').forEach(row => {
          row.style.display = 'none';
        });
        contentRow.style.display = 'table-row';
      } else {
        contentRow.style.display = 'none';
      }
    }

    // Ë©≥Á¥∞Ê§úÁ¥¢„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
    function toggleAdvancedSearch() {
      const advancedSearch = document.getElementById('advanced-search');
      const advancedBtn = document.getElementById('advanced-search-btn');

      if (advancedSearch.style.display === 'none') {
        advancedSearch.style.display = 'block';
        advancedBtn.textContent = '‚öôÔ∏è Á∞°ÊòìÊ§úÁ¥¢';
      } else {
        advancedSearch.style.display = 'none';
        advancedBtn.textContent = '‚öôÔ∏è Ë©≥Á¥∞Ê§úÁ¥¢';
      }
    }

    // „É°„É≥„Éê„ÉºË°®Á§∫„ÅÆÂàá„ÇäÊõø„Åà
    function toggleMoreMembers() {
      const moreMembers = document.getElementById('more-members');
      const showMoreBtn = document.querySelector('.show-more-btn');

      if (moreMembers.style.display === 'none') {
        moreMembers.style.display = 'block';
        showMoreBtn.textContent = '‰∏ÄÈÉ®„ÇíË°®Á§∫';
      } else {
        moreMembers.style.display = 'none';
        showMoreBtn.textContent = '„Åô„Åπ„Å¶Ë°®Á§∫';
      }
    }

    // Âü∫Êú¨Ê§úÁ¥¢„ÅÆ„É™„Çª„ÉÉ„Éà
    function resetSearch() {
      window.location.href = '/';
    }

    // Ë©≥Á¥∞Ê§úÁ¥¢„Éï„Ç©„Éº„É†„ÅÆ„É™„Çª„ÉÉ„Éà
    function resetAdvancedForm() {
      const form = document.getElementById('search-form');

      // „Åô„Åπ„Å¶„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Çí„ÇØ„É™„Ç¢
      form.querySelectorAll('input[type="text"], input[type="date"]').forEach(input => {
        input.value = '';
      });

      // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
      form.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });

      // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åô
      form.querySelectorAll('select').forEach(select => {
        if (select.name !== 'member') { // Âü∫Êú¨Ê§úÁ¥¢„ÅÆ„É°„É≥„Éê„ÉºÈÅ∏Êäû„ÅØÈô§„Åè
          select.selectedIndex = 0;
        }
      });

      // „É©„Ç∏„Ç™„Éú„Çø„É≥„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åô
      document.getElementById('sort-desc').checked = true;
    }

    // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÊìç‰Ωú
    function selectAll() {
      const checkboxes = document.querySelectorAll('.post-checkbox');
      checkboxes.forEach(cb => cb.checked = true);
      updateSelectedCount();
    }

    function deselectAll() {
      const checkboxes = document.querySelectorAll('.post-checkbox');
      checkboxes.forEach(cb => cb.checked = false);
      updateSelectedCount();
    }

    function updateSelectedCount() {
      const selectedCount = document.querySelectorAll('.post-checkbox:checked').length;
      document.getElementById('selected-count').textContent = selectedCount + '‰ª∂ÈÅ∏Êäû‰∏≠';
    }

    // ‰∏ÄÊã¨ÂâäÈô§
    async function bulkDelete() {
      const selectedCheckboxes = document.querySelectorAll('.post-checkbox:checked');

      if (selectedCheckboxes.length === 0) {
        alert('ÂâäÈô§„Åô„ÇãÊäïÁ®ø„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
      }

      const postIds = Array.from(selectedCheckboxes).map(cb => cb.value);

      if (!confirm(`ÈÅ∏Êäû„Åó„Åü${postIds.length}‰ª∂„ÅÆÊäïÁ®ø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
        return;
      }

      try {
        const response = await fetch('/api/posts/bulk-delete', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ postIds: postIds })
        });

        const result = await response.json();

        if (result.success) {
          alert(`${result.deletedCount}‰ª∂„ÅÆÊäïÁ®ø„ÅåÂâäÈô§„Åï„Çå„Åæ„Åó„Åü`);
          location.reload(); // „Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ
        } else {
          alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + result.message);
        }
      } catch (error) {
        alert('ÂâäÈô§‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
        console.error(error);
      }
    }

    // „Éö„Éº„Ç∏„Éà„ÉÉ„Éó„Å∏„Çπ„ÇØ„É≠„Éº„É´
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // „Çπ„ÇØ„É≠„Éº„É´ÊôÇ„Å´„Éú„Çø„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
    function toggleScrollButton() {
      const scrollButton = document.getElementById('scroll-to-top');
      if (window.pageYOffset > 300) {
        scrollButton.classList.add('show');
      } else {
        scrollButton.classList.remove('show');
      }
    }

    // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„ÅÆË®≠ÂÆö
    document.addEventListener('DOMContentLoaded', function() {
      // Ê§úÁ¥¢„Éï„Ç£„Éº„É´„Éâ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Éï„Ç©„Éº„Ç´„Çπ
      const searchInput = document.querySelector('.search-input-main');
      if (searchInput && !searchInput.value) {
        searchInput.focus();
      }

      // „Çπ„ÇØ„É≠„Éº„É´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
      window.addEventListener('scroll', toggleScrollButton);

      // ÂàùÊúüË°®Á§∫ÊôÇ„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ
      toggleScrollButton();
    });
  </script>
</body>
</html>